---
const links = [
  { href: "/", label: "Inicio" },
  { href: "/nosotros", label: "Nosotros" },
  { href: "/servicios", label: "Servicios" },
  { href: "/ventajas", label: "Ventajas" },
  { href: "/contacto", label: "Contacto" },
];

const currentPath = Astro.url.pathname;
---
<header class="relative top-0 z-50 bg-white/70 backdrop-blur-md backdrop-saturate-150 supports-[backdrop-filter]:bg-white/60 border-b border-whale/10 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 sm:px-6">
    <div class="flex items-center justify-between py-3 md:py-4">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3" aria-label="Ir al inicio">
        <img
          aria-label="Logo de la empresa R&C Group"
          src="/images/logo_mas_letras.webp"
          alt="Logo de la empresa R&C Group"
          class="h-10 md:h-12 w-auto"
        />
        <span class="sr-only">R&amp;C Group</span>
      </a>

      <!-- Navegación (escritorio) -->
      <nav class="hidden md:flex items-center gap-3">
        <div class="flex items-center gap-1.5 rounded-full p-1 shadow-sm bg-gradient-to-b from-white/80 to-white/50 bg-white/70 backdrop-blur-sm ring-1 ring-whale/15">
          {
            links
              .filter((l) => l.href !== "/contacto")
              .map((link) => {
                const active = currentPath === link.href;
                return (
                  <a
                    href={link.href}
                    aria-current={active ? "page" : undefined}
                    class={`px-4 py-2 rounded-full font-semibold transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-golden
                      ${active
                        ? "bg-golden text-whale shadow"
                        : "text-whale/90 hover:bg-whale/10 hover:text-whale"
                      }`}
                  >
                    {link.label}
                  </a>
                );
              })
          }
        </div>
      </nav>

      <!-- CTA (escritorio) -->
      <a
        href="/contacto"
        class="hidden md:inline-flex items-center justify-center px-4 py-2 rounded-full font-extrabold bg-golden text-whale shadow hover:brightness-95 focus:outline-none focus:ring-2 focus:ring-golden"
      >
        Contacto
      </a>

      <!-- Botón menú (móvil) -->
      <button
        id="menuButton"
        class="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-md text-whale hover:bg-whale/10 focus:outline-none focus:ring-2 focus:ring-golden"
        aria-label="Abrir menú"
        aria-controls="mobileNav"
        aria-expanded="false"
        type="button"
      >
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="3" y1="6" x2="21" y2="6" />
          <line x1="3" y1="12" x2="21" y2="12" />
          <line x1="3" y1="18" x2="21" y2="18" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Menú desplegable (móvil) -->
  <div id="mobileNav" class="absolute left-0 right-0 top-full md:hidden hidden">
    <nav class="bg-white/95 text-whale backdrop-blur shadow-lg border-t border-whale/10">
      <ul class="flex flex-col divide-y divide-whale/10">
        {
          links.map((link) => {
            const active = currentPath === link.href;
            return (
              <li>
                <a
                  href={link.href}
                  aria-current={active ? "page" : undefined}
                  class={`block px-5 py-4 font-extrabold text-base transition-colors
                    ${active
                      ? "bg-golden text-whale"
                      : "hover:bg-whale/5"
                    }`}
                >
                  {link.label}
                </a>
              </li>
            );
          })
        }
      </ul>
    </nav>
  </div>

  <script is:inline>
    // Toggle simple para el menú móvil
    (function () {
      const btn = document.getElementById('menuButton');
      const panel = document.getElementById('mobileNav');
      if (!btn || !panel) return;

      const close = () => {
        panel.classList.add('hidden');
        btn.setAttribute('aria-expanded', 'false');
      };
      const open = () => {
        panel.classList.remove('hidden');
        btn.setAttribute('aria-expanded', 'true');
      };

      let openState = false;
      const toggle = () => {
        openState ? close() : open();
        openState = !openState;
      };

      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        toggle();
      });

      document.addEventListener('click', (e) => {
        if (!openState) return;
        if (!panel.contains(e.target) && !btn.contains(e.target)) {
          openState = false;
          close();
        }
      });

      // Cerrar al navegar
      panel.addEventListener('click', (e) => {
        const target = e.target;
        if (target && target.tagName === 'A') {
          openState = false;
          close();
        }
      });
    })();
  </script>
</header>
